<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.metawater.mapper.OrderMapper">
    <resultMap id="orderMap" type="com.example.metawater.domain.OrderVO">
        <id property="orderNo" column="order_no"/>
        <result property="productNo" column="product_no"/>
        <result property="memNo" column="mem_no"/>
        <result property="renNo" column="ren_no"/>
        <result property="orderState" column="order_state"/>
        <result property="orderHopedate" column="order_hopedate"/>
        <result property="orderAdd" column="order_add"/>
        <result property="orderName" column="order_name"/>
        <result property="orderPhone" column="order_phone"/>
        <result property="orderDate" column="order_date"/>
        <result property="orderType" column="order_type"/>
        <result property="orderPay" column="order_pay"/>
        <association property="member" resultMap="memberMap"/>
        <association property="product" resultMap="productMap"/>
        <association property="rental" resultMap="rentalMap"/>
    </resultMap>

    <resultMap id="memberMap" type="com.example.metawater.domain.MemberVO">
        <id property="memNo" column="mem_no"/>
        <result property="memId" column="mem_id"/>
        <result property="memPw" column="mem_pw"/>
        <result property="memName" column="mem_name"/>
        <result property="memPhone" column="mem_phone"/>
        <result property="memEmail" column="mem_email"/>
    </resultMap>

    <resultMap id="productMap" type="com.example.metawater.domain.ProductVO">
        <id property="productNo" column="product_no"/>
        <result property="productName" column="product_name"/>
        <result property="productRentalPrice" column="product_rentalPrice"/>
        <result property="productPrice" column="product_price"/>
    </resultMap>

    <resultMap id="rentalMap" type="com.example.metawater.domain.RentalVO">
        <id property="renNo" column="ren_no"/>
        <result property="renInstallCost" column="ren_installCost"/>
        <result property="renEndDate" column="ren_endDate"/>
        <result property="renTerm" column="ren_term"/>
        <result property="renPayDate" column="ren_payDate"/>
        <result property="productNo" column="product_no"/>
    </resultMap>

    <insert id="rentalInsert">
        INSERT INTO rental VALUES (RENTAL_SEQ.nextval,#{ren_installcost},'2022/02/23',#{ren_term},#{ren_paydate},41)
    </insert>

    <insert id="orderInsert">

    </insert>

<!--    구매 목록 조회-->
    <select id="orderList" resultMap="orderMap">
        select * from
        pr_order inner join member
        on pr_order.mem_no = member.mem_no
        inner join product
        on pr_order.product_no = product.product_no
        where order_type = '구매'
    </select>

    <select id="orderRentalList" resultMap="orderMap">
        select * from
            pr_order inner join member
                                on pr_order.mem_no = member.mem_no
                     inner join rental
                                on pr_order.ren_no = rental.ren_no
                     inner join product
                                on pr_order.product_no = product.product_no
        where order_type = '렌탈'
    </select>

<!--주문 상세 조회-->
    <select id="orderDetail" resultMap="orderMap">
        select * from
            pr_order inner join member
                                on pr_order.mem_no = member.mem_no
                     inner join product
                                on pr_order.product_no = product.product_no
                     where order_no=#{orderNo}
    </select>
    
<!--    주문 상태 변경-->
    <update id="updateOrderState">
        update pr_order
        set  order_state = #{orderState}
        where order_no = #{orderNo}
    </update>

</mapper>